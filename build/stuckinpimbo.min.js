function player_change_action(){for(var a=game.player,b=library.data.player.indexOf(a),c=[],d=0;3>d;d++)d!==b&&c.push(library.data.player[d]);var e=Math.floor(2*Math.random());game.player=c[e],elements.player_action.textContent=game.player,playMusic(library.player_sound)}function gameUpdate(){gameRender(),gameInfoUpdate(),game.running&&createSchtuff()}function gameRender(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),renderPortal();for(var a=0;a<game.skulls.length;a++)renderSkull(a);for(var b=0;b<game.magic.length;b++)renderMagic(b);for(var c=0;c<game.pims.length;c++)renderPim(c)}function gameInfoUpdate(){for(var a=0;a<game.skulls.length;a++);for(var b=0;b<game.magic.length;b++)updateMagic(b);for(var c=0;c<game.pims.length;c++)updatePim(c);updatePortal()}function createSchtuff(){if(game.skulls.length<game.limit[1])for(var a=0;a<game.limit[1]-game.skulls.length;a++)Math.random()>.5&&chance();if(game.magic.length<game.limit[2])for(var b=0;b<game.limit[2]-game.magic.length;b++)Math.random()>.9&&fate()}function initCreate(){for(var a=0;a<game.limit[0];a++)god();destination()}function renderPim(a){var b=game.pims[a];if(b.poof)elements.c.drawImage(library.poof,b.tick*library.poof_size[2],0,library.poof_size[2],library.poof_size[3],b.pos[0],b.pos[1],library.poof_size[2]*library.multiplier,library.poof_size[3]*library.multiplier);else{var c,d,e,f,g,h,i,j,k;if("cyan"===b.color?c=1:"magenta"===b.color?c=0:"yellow"===b.color&&(c=2),"ghost"===b.state?d=3:"zombie"===b.state?d=2:"pim"===b.state&&b.dancing?d=0:"pim"===b.state&&(d=1),"right"===b.direction?e=0:"left"===b.direction?e=1:"down"===b.direction?e=2:"up"===b.direction&&(e=3),f=b.tick,g=4*library.pim_size[2]*c+f*library.pim_size[2],h=d?library.pim_size[3]+4*(d-1)*library.pim_size[3]+e*library.pim_size[3]:0,i=library.pim_size[2]*library.multiplier,j=library.pim_size[3]*library.multiplier,k=[library.pim,g,h,library.pim_size[2],library.pim_size[3],b.pos[0],b.pos[1],i,j],b.primed){var l;l="ghost"===b.state?b.pos[1]+17-library.excla_size[1]*library.multiplier:b.pos[1]-library.excla_size[1]*library.multiplier,elements.c.drawImage(library.excla,0,0,library.excla_size[0],library.excla_size[1],b.pos[0]+i/2.5,l,library.excla_size[0]*library.multiplier,library.excla_size[1]*library.multiplier)}elements.c.drawImage(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8])}}function updatePim(a){var c,d,e,b=game.pims[a],f=10;3===b.tick?(b.tick=0,b.onDestiny||b.countdown--,b.primed&&0===b.prime_countdown?(b.primed=!1,console.log("disengaged pim"),b.prime_countdown=10,"pim"===b.state&&console.log("we got issue")):b.primed&&b.prime_countdown--,b.poof&&(b.poof=!1,b.onDestiny&&(b.done=!0,playMusic(library.portal_sound),game.pims.splice(a,1),!game.pims.length&&game.limit[0]>1&&roundOver()))):b.tick++,0===b.countdown&&b.dancing?(b.dancing=!1,b.goToLight()):0!==b.countdown||b.dancing||b.onDestiny||b.primed||b.changeDirection("random"),"ghost"===b.state?e=1.5:"zombie"===b.state?e=.5:"pim"===b.state&&(e=1),b.primed&&b.collide(),b.dancing||(b.onDestiny&&Math.abs(b.destiny[0]-b.pos[0])<=50*library.multiplier&&("left"===b.direction||"right"===b.direction)?b.direction="up":"left"===b.direction?(d=b.pos[0]-f*e,0>=d?(b.pos[0]=0,b.changeDirection("random")):b.pos[0]=d):"right"===b.direction?(d=b.pos[0]+f*e,c=library.canvas[0]-library.pim_size[2]*library.multiplier,d>=c?(b.pos[0]=c,b.changeDirection("random")):b.pos[0]=d):"up"===b.direction?(d=b.pos[1]-f*e,0>=d?(b.pos[1]=0,b.changeDirection("random")):b.onDestiny&&Math.abs(b.destiny[1]-b.pos[1])<=50*library.multiplier?b.poof=!0:b.pos[1]=d):"down"===b.direction&&(d=b.pos[1]+f*e,c=library.canvas[1]-library.pim_size[3]*library.multiplier,d>=c?(b.pos[1]=c,b.changeDirection("random")):b.pos[1]=d))}function renderSkull(a){var b=game.skulls[a];elements.c.drawImage(library.skull,0,0,library.skull_size[0],library.skull_size[1],b.pos[0],b.pos[1],library.skull_size[0]*library.multiplier,library.skull_size[1]*library.multiplier)}function updateSkull(a){var b=game.skulls[a];0===b.countdown?game.skulls.splice(a,1):b.countdown--}function renderMagic(a){var c,d,e,f,b=game.magic[a];c=b.tick*library.magic_size[2],"cyan"===b.color?d=0:"yellow"===b.color?d=1:"magenta"===b.color&&(d=2),d*=library.magic_size[3],e=library.magic_size[2]*library.multiplier,f=library.magic_size[3]*library.multiplier,elements.c.drawImage(library.magic,c,d,library.magic_size[2],library.magic_size[3],b.pos[0],b.pos[1],e,f)}function updateMagic(a){var b=game.magic[a];3===b.tick?(b.tick=0,0===b.countdown&&game.magic.splice(a,1)):b.tick++}function renderPortal(){var b,c,d,e,a=game.portal[0];b=a.tick*library.portal_size[2],c=0,d=library.portal_size[2]*library.multiplier,e=library.portal_size[3]*library.multiplier,elements.c.drawImage(library.portal,b,c,library.portal_size[2],library.portal_size[3],a.pos[0],a.pos[1],d,e)}function updatePortal(){var a=game.portal[0];3===a.tick?a.tick=0:a.tick++}function playMusic(a){library.data.music&&a.play()}function accessTutorial(){this.removeEventListener("click",accessTutorial,!1),elements.opening.style.opacity=0,elements.opening.addEventListener("transitionend",goToTutorialScreen,!1)}function goToTutorialScreen(){this.removeEventListener("transitionend",goToTutorialScreen,!1),elements.opening.classList.add("hidden"),elements.game.classList.remove("hidden"),window.setTimeout(function(){elements.game.style.opacity=1,elements.game.addEventListener("transitionend",prepTutorial,!1)},100)}function prepTutorial(){this.removeEventListener("transitionend",prepTutorial,!1),message("welcome to pimbo",2500),window.setTimeout(function(){console.log("doing the tutorial"),tutorial_start(),showTutorialStep()},3e3)}function tutorial_start(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),elements.c.globalAlpha=1,reset_game_info("tutorial"),game.start=new Date,game.running=!0,game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100)}function showTutorialStep(){var a=tutorial.step,b=tutorial.instructions[a][2];if(elements.tut_h.innerHTML=tutorial.instructions[a][0],elements.tut_p.innerHTML=tutorial.instructions[a][1],"next"===b)elements.tut_b.textContent="next",elements.tut_b.addEventListener("click",nextStepSimple,!1),checkTutorialStep();else if("again"===b){elements.tut_b.textContent="repeat?",elements.tut_b.addEventListener("click",repeatTutorial,!1);var c=document.createElement("p");c.classList.add("button","gotogame"),c.textContent="start playing",elements.tutorial.appendChild(c),c.addEventListener("click",leaveTutorial,!1)}else elements.tut_b.textContent="okay, try",elements.tut_b.addEventListener("click",startCheckingCriteria,!1);elements.tutorial.classList.remove("hidden")}function checkTutorialStep(){switch(tutorial.step){case 0:console.log("step 0, spawned a pim"),god(),destination();break;case 1:console.log("step 1, added clicking ability to pim"),elements.canvas.addEventListener("click",pushPim,!1);break;case 2:console.log("step 2, added skull, stopped game loop and clicking pim ability"),chance(),window.setTimeout(toggleGameTutorialPlay,100);break;case 4:console.log("step 4, started game loop and added clicking pim ability"),toggleGameTutorialPlay("play");break;case 5:console.log("step 5, removing pim clicking"),elements.canvas.removeEventListener("click",pushPim,!1);break;case 6:console.log("step 6, spawning magic, a lot of it");for(var a=0;10>a;a++)fate();break;case 7:console.log("step 7, adding click"),elements.canvas.addEventListener("click",pushPim,!1);break;case 8:console.log("step 8, dancing!"),elements.canvas.removeEventListener("click",pushPim,!1),game.pims[0].countdown=-1;break;case 9:console.log("step 9, going to the light!"),console.log(game.pims[0].countdown),game.pims[0].countdown=1,console.log(game.pims[0].countdown);break;default:console.log("moving along")}}function toggleGameTutorialPlay(a){"play"===a?(elements.canvas.addEventListener("click",pushPim,!1),game.loop=window.setInterval(gameUpdate,100)):(window.clearInterval(game.loop),elements.canvas.removeEventListener("click",pushPim,!1))}function nextStepSimple(){this.removeEventListener("click",nextStepSimple,!1),elements.tutorial.classList.add("hidden"),tutorial.next(),showTutorialStep()}function startCheckingCriteria(){this.removeEventListener("click",startCheckingCriteria,!1),elements.tutorial.classList.add("hidden"),checkTutorialStep(),tutorial.checking=window.setInterval(checkingCriteria,100)}function checkingCriteria(){var str=tutorial.instructions[tutorial.step][2];eval(str)&&(window.clearInterval(tutorial.checking),tutorial.next(),showTutorialStep())}function repeatTutorial(){this.removeEventListener("click",repeatTutorial,!1);var a=this.parentNode.getElementsByTagName("p")[2];this.parentNode.removeChild(a),elements.tutorial.classList.add("hidden"),tutorial.step=0,message("welcome to pimbo",2500),window.setTimeout(function(){console.log("doing the tutorial"),tutorial_start(),showTutorialStep()},3e3)}function leaveTutorial(){this.removeEventListener("click",leaveTutorial,!1),this.parentNode.removeChild(this),elements.tut_b.removeEventListener("click",repeatTutorial,!1),elements.tutorial.classList.add("hidden"),message("good job, now have fun",2e3),window.setTimeout(function(){prepGame()},3e3)}function Pim(a){this.color=a,this.state="ghost",this.tick=0,this.direction="down",this.done=!1,this.onDestiny=!1,this.destiny=[null,null],this.countdown=Math.floor(6*Math.random())+1,this.primed=!1,this.prime_countdown=10,this.poof=!1,this.dancing=!1;var b=Math.floor(Math.random()*(library.canvas[0]-library.pim_size[2]*library.multiplier)),c=Math.floor(Math.random()*(library.canvas[1]-library.pim_size[3]*library.multiplier));this.pos=[b,c]}function god(){var a=game.pims.length,b=library.data.color[a%3],c=new Pim(b);game.pims.push(c)}function Skull(){var a=Math.floor(Math.random()*(library.canvas[0]-library.pim_size[2]*library.multiplier)),b=Math.floor(Math.random()*(library.canvas[1]-library.pim_size[3]*library.multiplier));this.guid=Math.random(),this.countdown=Math.floor(50*Math.random())+100,this.pos=[a,b]}function chance(){var a=new Skull;game.skulls.push(a)}function Magic(a){this.color=a,this.tick=0,this.countdown=Math.floor(30*Math.random())+15;var b=Math.floor(Math.random()*(library.canvas[0]-library.magic_size[2]*library.multiplier)),c=Math.floor(Math.random()*(library.canvas[1]-library.magic_size[3]*library.multiplier));this.pos=[b,c]}function fate(){var a=game.magic.length,b=library.data.color[a%3],c=new Magic(b);game.magic.push(c)}function Portal(){var a,b;this.tick=0,a=library.canvas[0]/2-library.portal_size[2]*library.multiplier/2,b=0,this.pos=[a,b]}function destination(){var a=new Portal;game.portal.push(a)}function pushPim(a){var b=[];b[0]=a.pageX-this.offsetLeft-library.pim_size[2]/2,b[1]=a.pageY-this.offsetTop-library.pim_size[3]/2;for(var c=0;c<game.pims.length;c++){var d=game.pims[c],e=d.pos[0]-b[0],f=d.pos[1]-b[1];e>=-50*Math.round(library.multiplier)&&e<=50*Math.round(library.multiplier)&&f>=-50*Math.round(library.multiplier)&&f<=50*Math.round(library.multiplier)&&"pim"!==d.state&&d.changeDirection("player")}}function init(){var a=init_screens();a?(init_loadingImages(),init_info()):uponFailure()}function init_screens(){var a=window.innerWidth,b=window.innerHeight;library.scr[0]=a,library.scr[1]=b,library.canvas[0]=a,library.canvas[1]=b;var c;c=400>a?.75:a>=400&&1e3>a?1.25:a>=1e3&&1600>a?1.5:a>=1600?2:1,library.multiplier=c,elements.message.style.top=.45*library.scr[1]+"px",elements.c=elements.canvas.getContext("2d");var d;return null!==elements.c?(elements.canvas.setAttribute("height",library.canvas[1]),elements.canvas.setAttribute("width",library.canvas[0]),d=!0):(library.data.poop=!0,d=!1),d}function init_loadingImages(){var a=[library.pim,library.magic,library.portal,library.poof,library.skull,library.bg,library.excla],b=[library.ghost_sound,library.zombie_sound,library.transform_sound,library.portal_sound,library.player_sound];library.pim.src="../images/pimsheet.svg",library.magic.src="../images/magic.svg",library.portal.src="../images/portal.svg",library.poof.src="../images/poof.svg",library.skull.src="../images/skull.svg",library.bg.src="../images/background.jpg",library.excla.src="../images/exclamation.svg",library.ghost_sound.src="../track/Ghost_01.wav",library.zombie_sound.src="../track/Action-02.wav",library.transform_sound.src="../track/Powerup_01.wav",library.portal_sound.src="../track/Portal-01.wav",library.player_sound.src="../track/Function-Change-01.wav";for(var c=0;c<a.length;c++)a[c].addEventListener("load",finishedLoading,!1);for(var d=0;d<b.length;d++)b[d].addEventListener("canplay",finishedLoading,!1)}function init_info(){checkLocalStorage();var a=Math.floor(3*Math.random());game.player=library.data.player[a],elements.player_action.textContent=game.player,prepareScreen(),elements.music.addEventListener("click",toggleSound,!1)}function prepareScreen(){elements.play.addEventListener("click",goToGame,!1),elements.open_tutorial.addEventListener("click",accessTutorial,!1)}function goToGame(){elements.opening.style.opacity=0,elements.opening.addEventListener("transitionend",goToGameScreen,!1)}function goToGameScreen(){elements.opening.removeEventListener("transitionend",goToGameScreen,!1),elements.opening.classList.add("hidden"),elements.game.classList.remove("hidden"),window.setTimeout(function(){elements.game.style.opacity=1,elements.game.addEventListener("transitionend",prepGame,!1)},100)}function prepGame(){console.log("the game should be starting"),elements.game.removeEventListener("transitionend",prepGame,!1),message("get ready",2500),window.setTimeout(function(){message("go!",750),game_start()},3e3)}function game_start(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),elements.c.globalAlpha=1,reset_game_info("game"),game.start=new Date,game.running=!0,initCreate(),game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100),elements.help_button.addEventListener("click",showHelp,!1),elements.canvas.addEventListener("click",pushPim,!1)}function reset_game_info(a){game.start=0,game.end=0,game.total=0,game.score=0,game.running=!1,game.finished=!1,"tutorial"===a?(game.pims.length=0,game.skulls.length=0,game.magic.length=0,game.limit[0]=1,game.limit[1]=0,game.limit[2]=0):(game.round=library.data.rounds,game.pims.length=0,game.skulls.length=0,game.magic.length=0,game.limit[0]=game.round+3,game.limit[1]=game.round+3,game.limit[2]=Math.floor(5*Math.random())+2*game.round+10),window.clearInterval(game.loop),window.clearInterval(game.player_loop),game.player=library.data.player[Math.floor(3*Math.random())]}function roundOver(){game.running=!1,game.finished=!0,window.clearInterval(game.player_loop),elements.canvas.removeEventListener("click",pushPim,!1),game.end=new Date;var a=(game.end.getTime()-game.start.getTime())/1e3/60;game.total+=a,library.data.rounds++;var b=1e3*library.data.rounds*(game.limit[0]/3+3)-2*60*a;b=Math.round(b),game.score=b,checkHighscore(b),showEnd()}function checkHighscore(a){a&&a>library.data.highscore&&(library.data.highscore=a,window.localStorage.pimbo=a)}function checkLocalStorage(){if(window.localStorage.pimbo){var a=Number(window.localStorage.pimbo);library.data.highscore=a,elements.highscore_open.textContent=a,elements.highscore_open.parentElement.classList.remove("hidden")}else window.localStorage.setItem("pimbo",0)}function showHelp(){game.running=!1,window.clearInterval(game.loop),window.clearInterval(game.player_loop),game.end=new Date;var a=(game.end.getTime()-game.start.getTime())/1e3/60;game.total+=a,updateHelpInfo(),elements.info.classList.remove("hidden"),window.setTimeout(function(){elements.info.style.opacity=1},100),elements.help_button.classList.remove("helphover"),elements.canvas.removeEventListener("click",pushPim,!1),elements.help_button.removeEventListener("click",showHelp,!1),elements.info_close.addEventListener("click",hideHelp,!1)}function updateHelpInfo(){var a,b=Math.floor(game.total)+":";b+=60*(1-(Math.ceil(game.total)-game.total)),elements.info_round.textContent=library.data.rounds+1,elements.info_time.textContent=Math.round(60*game.total)+" seconds",a=library.data.highscore?library.data.highscore:"noop",elements.highscore_info.textContent=a}function hideHelp(){elements.info.style.opacity=0,elements.help_button.classList.add("helphover"),elements.info_close.removeEventListener("click",hideHelp,!1),elements.info.addEventListener("transitionend",startGameAgain,!1)}function startGameAgain(){elements.info.removeEventListener("transitionend",startGameAgain,!1),elements.info.classList.add("hidden"),window.setTimeout(function(){game.running=!0,game.start=new Date,game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100),elements.help_button.addEventListener("click",showHelp,!1),elements.canvas.addEventListener("click",pushPim,!1)},200)}function showEnd(){elements.end_ghosts.textContent=game.limit[0]+" pims",elements.end_time.textContent=Math.round(60*game.total)+" seconds",elements.end_score.textContent=game.score,elements.highscore_end.textContent=library.data.highscore,elements.highscore_end.parentElement.classList.remove("hidden"),elements.help_button.classList.remove("helphover"),elements.ending.classList.remove("hidden"),window.setTimeout(function(){elements.ending.style.opacity=1},500),elements.canvas.removeEventListener("click",pushPim,!1),elements.help_button.removeEventListener("click",showHelp,!1),elements.play_again.addEventListener("click",playAgain,!1)}function playAgain(){elements.ending.style.opacity=0,elements.ending.addEventListener("transitionend",showGameScreenAgain,!1)}function showGameScreenAgain(){this.removeEventListener("transitionend",showGameScreenAgain,!1),elements.ending.classList.add("hidden"),elements.play_again.removeEventListener("click",playAgain,!1),elements.canvas.addEventListener("click",pushPim,!1),elements.help_button.addEventListener("click",showHelp,!1),elements.help_button.classList.add("helphover"),message("get ready",2e3),window.setTimeout(function(){game_start(),message("go!",500)},2e3)}function message(a,b){elements.message.textContent=a,elements.message.classList.remove("hidden"),window.setTimeout(function(){elements.message.classList.add("hidden")},b)}function toggleSound(){library.data.music?(library.data.music=!1,elements.music.textContent="sound is off"):(library.data.music=!0,elements.music.textContent="sound is on")}function uponFailure(){var a=document.createElement("p");a.innerHTML="Sorry, this browser does not support <strong>canvas</strong>. You need canvas to play this game. Please consider another browser for your gaming pleasure.",elements.loading.appendChild(a)}function finishedLoading(){this.removeEventListener("load",finishedLoading,!1),library.assetsLoaded++,library.assetsLoaded===library.totalAssets&&allAssetsLoaded()}function allAssetsLoaded(){elements.ball.classList.remove("bouncy"),window.setTimeout(function(){elements.loading.style.opacity=0,elements.loading.addEventListener("transitionend",showHomeScreen,!1)},500)}function showHomeScreen(){elements.loading.removeEventListener("transitionend",showHomeScreen,!1),elements.loading.classList.add("hidden"),elements.opening.classList.remove("hidden"),window.setTimeout(function(){elements.opening.style.opacity=1},100)}var library={pim:new Image,magic:new Image,portal:new Image,poof:new Image,skull:new Image,bg:new Image,excla:new Image,ghost_sound:new Audio,zombie_sound:new Audio,transform_sound:new Audio,portal_sound:new Audio,player_sound:new Audio,totalAssets:12,assetsLoaded:0,scr:[],canvas:[],multiplier:0,pim_size:[864,1248,72,96],magic_size:[256,192,64,64],portal_size:[288,64,72,64],poof_size:[288,96,72,96],skull_size:[64,64],excla_size:[14,32],bg_size:[100,500],data:{poop:!1,highscore:null,rounds:0,music:!0,player:["reverse","clockwise","counter-clockwise"],color:["cyan","magenta","yellow"]}},game={start:null,end:null,total:0,score:0,running:!1,finished:!0,round:0,pims:[],skulls:[],magic:[],portal:[],limit:[null,null,null,1],player:null,player_loop:null,loop:null},elements={loading:document.getElementById("loading-screen"),opening:document.getElementById("open-screen"),game:document.getElementById("game-screen"),ending:document.getElementById("end-screen"),info:document.getElementById("info-screen"),player_action:document.getElementById("game-action"),canvas:document.getElementById("game-canvas"),c:null,ball:document.querySelector(".ball"),info_round:document.getElementById("info-round"),info_time:document.getElementById("info-time"),end_message:document.querySelector(".rando"),end_ghosts:document.getElementById("end-ghost-count"),end_time:document.getElementById("end-time"),end_score:document.getElementById("end-score"),open_tutorial:document.getElementById("open-tutorial"),tutorial:document.getElementById("tutorial"),tut_h:this.tutorial.querySelector("h2"),tut_p:this.tutorial.querySelectorAll("p")[0],tut_b:this.tutorial.querySelectorAll("p")[1],play:document.getElementById("open-play"),play_again:document.getElementById("end-play"),help_button:document.getElementById("game-help"),info_close:document.getElementById("info-closer"),message:document.getElementById("mega-message"),music:document.getElementById("sound-toggle"),highscore_open:document.getElementById("open-hs"),highscore_info:document.getElementById("info-highscore"),highscore_end:document.getElementById("end-hs")},tutorial={step:0,checking:null,instructions:[["Here is a ghost.","This ghost was once a pim. Now it floats around aimlessly, stuck in pimbo.","next"],["You can help this ghost.","The ghost will continue to wander aimlessly, until you <strong>prime</strong> it. <strong>Click on the ghost to prime it.<strong>","game.pims[0].primed"],['See the <strong>"!"</strong>',"Now the ghost is primed: it's on the lookout for <strong>skulls</strong> now. Collecting <strong>skulls</strong> will turn the ghost into a zombie.","next"],["Priming doesn't last","The ghost will lose interest if left on it's own for too long. Clicking it again will <strong>prime</strong> it again.","next"],["Direct the ghost","See the container at the bottom? It contains the keyword that determines what happens when you click the ghost. It changes every 5 seconds. Use this to direct the ghost to the <strong>skull</strong>.","game.pims[0].state === 'zombie'"],["Look! A zombie!","Now that the ghost collected a <strong>skull</strong>, it's turned into a zombie. It's on its way to becoming a full fledged pim again.","next"],["Zombies need life.","Just like ghosts needed <strong>skulls</strong>, zombies will need <strong>life</strong> to become pims.","next"],["The same rules apply.","Direct the zombies by <strong>clicking</strong> them towards life. The color of the life must match the color of the pim, and it needs to be <strong>primed</strong> in order to know what to look for.","game.pims[0].state === 'pim'"],["Good job!","You helped the pim reach its true form. It's celebrating right now.","next"],["Clear the board.","To win the round, you will need to clear the board by helping all the pims reach their true form. The faster you are, the more points you'll get at the end of the round.","next"],["Going to the light","Pims finished will go to the light. Quite fitting.","again"]],next:function(){this.step++},again:function(){this.step=0},amount:function(){return this.instructions.length}};Pim.prototype.changeDirection=function(a){var b=this.direction,c=["up","down","left","right"];if("random"===a){for(var d=c.indexOf(b),e=[],f=0;4>f;f++)f!==d&&e.push(c[f]);var g=Math.floor(3*Math.random());this.direction=e[g],this.countdown=Math.floor(5*Math.random())+5}else if("player"===a){var h=game.player;"reverse"===h?"up"===b?this.direction="down":"down"===b?this.direction="up":"left"===b?this.direction="right":"right"===b&&(this.direction="left"):"clockwise"===h?"up"===b?this.direction="right":"down"===b?this.direction="left":"left"===b?this.direction="up":"right"===b&&(this.direction="down"):"counter-clockwise"===h&&("up"===b?this.direction="left":"down"===b?this.direction="right":"left"===b?this.direction="down":"right"===b&&(this.direction="up")),this.primed=!0,"ghost"===this.state?playMusic(library.ghost_sound):"zombie"===this.state&&playMusic(library.zombie_sound),console.log("changed direction, thanks human"),this.prime_countdown=10}},Pim.prototype.collide=function(){var a=[];a[0]=this.pos[0],a[1]=this.pos[1],"ghost"===this.state?this.checkCollide("skulls",50,a):"zombie"===this.state&&this.checkCollide("magic",50,a)},Pim.prototype.checkCollide=function(a,b,c){var d=game[a],e=b,f=[];"skulls"===a?(f[0]=library.skull_size[0],f[1]=library.skull_size[1]):(f[0]=library.magic_size[2],f[1]=library.magic_size[3]);for(var g=0;g<d.length;g++){var h=d[g],i=[],j=!1;if(i[0]=h.pos[0],i[1]=h.pos[1],Math.abs(i[0]-c[0])<=e&&Math.abs(i[1]-c[1])<=e){var k;"zombie"===this.state&&this.color===h.color?(k="The "+this.color+" pim going "+this.direction+" touched the "+h.color+" magic. The pim was at "+c+" the magic was at "+i+".",console.log(k),j=!0):"ghost"===this.state&&(k="The "+this.color+" ghost going "+this.direction+" touched the skull at "+i+". The pim was at "+c+" the skull had a guid of "+h.guid+".",console.log(k),j=!0)}j&&("ghost"===this.state?this.state="zombie":"zombie"===this.state&&(this.state="pim",this.dancing=!0),playMusic(library.transform_sound),this.countdown=Math.floor(6*Math.random())+1,this.primed=!1,this.prime_countdown=10,this.tick=0,this.poof=!0,d.splice(g,1))}},Pim.prototype.goToLight=function(){console.log("going to the light"),this.onDestiny=!0,this.destiny[0]=game.portal[0].pos[0],this.destiny[1]=0,this.direction=this.pos[0]<this.destiny[0]?"right":"left"},init();