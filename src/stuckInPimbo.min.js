!function(exports,global){function Pim(color){this.color=color,this.state="ghost",this.tick=0,this.direction="down",this.done=!1,this.onDestiny=!1,this.destiny=[null,null],this.countdown=Math.floor(6*Math.random())+1,this.primed=!1,this.prime_countdown=10,this.poof=!1,this.dancing=!1;var pox=Math.floor(Math.random()*(library.canvas[0]-library.pim_size[2]*library.multiplier)),poy=Math.floor(Math.random()*(library.canvas[1]-library.pim_size[3]*library.multiplier));this.pos=[pox,poy]}function god(){var amount=game.pims.length,c=library.data.color[amount%3],p=new Pim(c);game.pims.push(p)}function Skull(){var pox=Math.floor(Math.random()*(library.canvas[0]-library.pim_size[2]*library.multiplier)),poy=Math.floor(Math.random()*(library.canvas[1]-library.pim_size[3]*library.multiplier));this.guid=Math.random(),this.countdown=Math.floor(50*Math.random())+100,this.pos=[pox,poy]}function chance(){var s=new Skull;game.skulls.push(s)}function Magic(color){this.color=color,this.tick=0,this.countdown=Math.floor(30*Math.random())+15;var pox=Math.floor(Math.random()*(library.canvas[0]-library.magic_size[2]*library.multiplier)),poy=Math.floor(Math.random()*(library.canvas[1]-library.magic_size[3]*library.multiplier));this.pos=[pox,poy]}function fate(){var amount=game.magic.length,c=library.data.color[amount%3],m=new Magic(c);game.magic.push(m)}function Portal(){var pox,poy;this.tick=0,pox=library.canvas[0]/2-library.portal_size[2]*library.multiplier/2,poy=0,this.pos=[pox,poy]}function destination(){var p=new Portal;game.portal.push(p)}function pushPim(e){var input=[];e.preventDefault(),"touchstart"===e.type?(input[0]=e.touches[0].clientX-this.offsetLeft-library.pim_size[2]/2,input[1]=e.touches[0].clientY-this.offsetTop-library.pim_size[3]/2):(input[0]=e.pageX-this.offsetLeft-library.pim_size[2]/2,input[1]=e.pageY-this.offsetTop-library.pim_size[3]/2),console.log("this is where I clicked: "+input[0]+" "+input[1]);for(var i=0;i<game.pims.length;i++){var pim=game.pims[i],distx=pim.pos[0]-input[0],disty=pim.pos[1]-input[1];distx>=-50*Math.round(library.multiplier)&&distx<=50*Math.round(library.multiplier)&&disty>=-50*Math.round(library.multiplier)&&disty<=50*Math.round(library.multiplier)&&"pim"!==pim.state&&pim.changeDirection("player")}}function player_change_action(){for(var current=game.player,ind=library.data.player.indexOf(current),options=[],i=0;3>i;i++)i!==ind&&options.push(library.data.player[i]);var choice=Math.floor(2*Math.random());game.player=options[choice],elements.player_action.textContent=game.player,playMusic(library.player_sound)}function gameUpdate(){gameRender(),gameInfoUpdate(),game.running&&createSchtuff()}function gameRender(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),renderPortal();for(var i=0;i<game.skulls.length;i++)renderSkull(i);for(var j=0;j<game.magic.length;j++)renderMagic(j);for(var k=0;k<game.pims.length;k++)renderPim(k)}function gameInfoUpdate(){for(var j=0;j<game.magic.length;j++)updateMagic(j);for(var k=0;k<game.pims.length;k++)updatePim(k);updatePortal()}function createSchtuff(){if(game.skulls.length<game.limit[1])for(var i=0;i<game.limit[1]-game.skulls.length;i++)Math.random()>.5&&chance();if(game.magic.length<game.limit[2])for(var j=0;j<game.limit[2]-game.magic.length;j++)Math.random()>.9&&fate()}function initCreate(){for(var i=0;i<game.limit[0];i++)god();destination()}function renderPim(num){var pim=game.pims[num];if(pim.poof)elements.c.drawImage(library.poof,pim.tick*library.poof_size[2],0,library.poof_size[2],library.poof_size[3],pim.pos[0],pim.pos[1],library.poof_size[2]*library.multiplier,library.poof_size[3]*library.multiplier);else{var c,s,d,t,sx,sy,dx,dy,param;if("cyan"===pim.color?c=1:"magenta"===pim.color?c=0:"yellow"===pim.color&&(c=2),"ghost"===pim.state?s=3:"zombie"===pim.state?s=2:"pim"===pim.state&&pim.dancing?s=0:"pim"===pim.state&&(s=1),"right"===pim.direction?d=0:"left"===pim.direction?d=1:"down"===pim.direction?d=2:"up"===pim.direction&&(d=3),t=pim.tick,sx=library.pim_size[2]*c*4+t*library.pim_size[2],sy=s?library.pim_size[3]+(s-1)*library.pim_size[3]*4+d*library.pim_size[3]:0,dx=library.pim_size[2]*library.multiplier,dy=library.pim_size[3]*library.multiplier,param=[library.pim,sx,sy,library.pim_size[2],library.pim_size[3],pim.pos[0],pim.pos[1],dx,dy],pim.primed){var offset;offset="ghost"===pim.state?pim.pos[1]+17-library.excla_size[1]*library.multiplier:pim.pos[1]-library.excla_size[1]*library.multiplier,elements.c.drawImage(library.excla,0,0,library.excla_size[0],library.excla_size[1],pim.pos[0]+dx/2.5,offset,library.excla_size[0]*library.multiplier,library.excla_size[1]*library.multiplier)}elements.c.drawImage(param[0],param[1],param[2],param[3],param[4],param[5],param[6],param[7],param[8])}}function updatePim(num){var limit,potential,rate,pim=game.pims[num],movement=10;3===pim.tick?(pim.tick=0,pim.onDestiny||pim.countdown--,pim.primed&&0===pim.prime_countdown?(pim.primed=!1,pim.prime_countdown=10,"pim"===pim.state&&console.log("we got issue")):pim.primed&&pim.prime_countdown--,pim.poof&&(pim.poof=!1,pim.onDestiny&&(pim.done=!0,playMusic(library.portal_sound),game.pims.splice(num,1),!game.pims.length&&game.limit[0]>1&&roundOver()))):pim.tick++,0===pim.countdown&&pim.dancing?(pim.dancing=!1,pim.goToLight()):0!==pim.countdown||pim.dancing||pim.onDestiny||pim.primed||pim.changeDirection("random"),"ghost"===pim.state?rate=1.5:"zombie"===pim.state?rate=.5:"pim"===pim.state&&(rate=1),pim.primed&&pim.collide(),pim.dancing||(pim.onDestiny&&Math.abs(pim.destiny[0]-pim.pos[0])<=50*library.multiplier&&("left"===pim.direction||"right"===pim.direction)?pim.direction="up":"left"===pim.direction?(potential=pim.pos[0]-movement*rate,0>=potential?(pim.pos[0]=0,pim.changeDirection("random")):pim.pos[0]=potential):"right"===pim.direction?(potential=pim.pos[0]+movement*rate,limit=library.canvas[0]-library.pim_size[2]*library.multiplier,potential>=limit?(pim.pos[0]=limit,pim.changeDirection("random")):pim.pos[0]=potential):"up"===pim.direction?(potential=pim.pos[1]-movement*rate,0>=potential?(pim.pos[1]=0,pim.changeDirection("random")):pim.onDestiny&&Math.abs(pim.destiny[1]-pim.pos[1])<=50*library.multiplier?pim.poof=!0:pim.pos[1]=potential):"down"===pim.direction&&(potential=pim.pos[1]+movement*rate,limit=library.canvas[1]-library.pim_size[3]*library.multiplier,potential>=limit?(pim.pos[1]=limit,pim.changeDirection("random")):pim.pos[1]=potential))}function renderSkull(num){var skull=game.skulls[num];elements.c.drawImage(library.skull,0,0,library.skull_size[0],library.skull_size[1],skull.pos[0],skull.pos[1],library.skull_size[0]*library.multiplier,library.skull_size[1]*library.multiplier)}function renderMagic(num){var sx,sy,dw,dh,magic=game.magic[num];sx=magic.tick*library.magic_size[2],"cyan"===magic.color?sy=0:"yellow"===magic.color?sy=1:"magenta"===magic.color&&(sy=2),sy*=library.magic_size[3],dw=library.magic_size[2]*library.multiplier,dh=library.magic_size[3]*library.multiplier,elements.c.drawImage(library.magic,sx,sy,library.magic_size[2],library.magic_size[3],magic.pos[0],magic.pos[1],dw,dh)}function updateMagic(num){var magic=game.magic[num];3===magic.tick?magic.tick=0:magic.tick++}function renderPortal(){var sx,sy,dw,dh,portal=game.portal[0];sx=portal.tick*library.portal_size[2],sy=0,dw=library.portal_size[2]*library.multiplier,dh=library.portal_size[3]*library.multiplier,elements.c.drawImage(library.portal,sx,sy,library.portal_size[2],library.portal_size[3],portal.pos[0],portal.pos[1],dw,dh)}function updatePortal(){var portal=game.portal[0];3===portal.tick?portal.tick=0:portal.tick++}function playMusic(what){library.data.music&&what.play()}function accessTutorial(){this.removeEventListener("click",accessTutorial,!1),this.removeEventListener("touchstart",accessTutorial,!1),elements.opening.style.opacity=0,elements.opening.addEventListener("transitionend",goToTutorialScreen,!1)}function goToTutorialScreen(){this.removeEventListener("transitionend",goToTutorialScreen,!1),elements.opening.classList.add("hidden"),elements.game.classList.remove("hidden"),window.setTimeout(function(){elements.game.style.opacity=1,elements.game.addEventListener("transitionend",prepTutorial,!1)},100)}function prepTutorial(){this.removeEventListener("transitionend",prepTutorial,!1),message("welcome to pimbo",2500),window.setTimeout(function(){tutorial_start(),showTutorialStep()},3e3)}function tutorial_start(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),elements.c.globalAlpha=1,reset_game_info("tutorial"),game.start=new Date,game.running=!0,game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100)}function showTutorialStep(){var step=tutorial.step,next=tutorial.instructions[step][2];if(elements.tut_h.innerHTML=tutorial.instructions[step][0],elements.tut_p.innerHTML=tutorial.instructions[step][1],"next"===next)elements.tut_b.textContent="next",elements.tut_b.addEventListener("click",nextStepSimple,!1),elements.tut_b.addEventListener("touchstart",nextStepSimple,!1),checkTutorialStep();else if("again"===next){elements.tut_b.textContent="repeat?",elements.tut_b.addEventListener("click",repeatTutorial,!1),elements.tut_b.addEventListener("touchstart",repeatTutorial,!1);var button=document.createElement("p");button.classList.add("button","gotogame"),button.textContent="start playing",elements.tutorial.appendChild(button),button.addEventListener("click",leaveTutorial,!1),button.addEventListener("touchstart",leaveTutorial,!1)}else elements.tut_b.textContent="okay, try",elements.tut_b.addEventListener("click",startCheckingCriteria,!1),elements.tut_b.addEventListener("touchstart",startCheckingCriteria,!1);elements.tutorial.classList.remove("hidden")}function checkTutorialStep(){switch(tutorial.step){case 0:god(),destination();break;case 1:elements.canvas.addEventListener("click",pushPim,!1),elements.canvas.addEventListener("touchstart",pushPim,!1);break;case 2:chance(),window.setTimeout(toggleGameTutorialPlay,100);break;case 4:toggleGameTutorialPlay("play");break;case 5:elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1);break;case 6:for(var i=0;10>i;i++)fate();break;case 7:elements.canvas.addEventListener("click",pushPim,!1),elements.canvas.addEventListener("touchstart",pushPim,!1);break;case 8:elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1),game.pims[0].countdown=-1;break;case 9:game.pims[0].countdown=1}}function toggleGameTutorialPlay(play){"play"===play?(elements.canvas.addEventListener("click",pushPim,!1),elements.canvas.addEventListener("touchstart",pushPim,!1),game.loop=window.setInterval(gameUpdate,100)):(window.clearInterval(game.loop),elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1))}function nextStepSimple(event){this.removeEventListener("click",nextStepSimple,!1),this.removeEventListener("touchstart",nextStepSimple,!1),elements.tutorial.classList.add("hidden"),tutorial.next(),showTutorialStep(),event.preventDefault()}function startCheckingCriteria(event){this.removeEventListener("click",startCheckingCriteria,!1),this.removeEventListener("touchstart",startCheckingCriteria,!1),elements.tutorial.classList.add("hidden"),checkTutorialStep(),tutorial.checking=window.setInterval(checkingCriteria,100),event.preventDefault()}function checkingCriteria(){var str=tutorial.instructions[tutorial.step][2];eval(str)&&(window.clearInterval(tutorial.checking),tutorial.next(),showTutorialStep())}function repeatTutorial(event){this.removeEventListener("click",repeatTutorial,!1),this.removeEventListener("touchstart",repeatTutorial,!1);var removeThis=this.parentNode.getElementsByTagName("p")[2];this.parentNode.removeChild(removeThis),elements.tutorial.classList.add("hidden"),tutorial.step=0,message("welcome to pimbo",2500),window.setTimeout(function(){tutorial_start(),showTutorialStep()},3e3),event.preventDefault()}function leaveTutorial(event){this.removeEventListener("click",leaveTutorial,!1),this.removeEventListener("touchstart",leaveTutorial,!1),this.parentNode.removeChild(this),elements.tut_b.removeEventListener("click",repeatTutorial,!1),elements.tut_b.removeEventListener("touchstart",repeatTutorial,!1),elements.tutorial.classList.add("hidden"),message("good job, now have fun",2e3),window.setTimeout(function(){prepGame()},3e3),event.preventDefault()}function init(){var r1=init_screens();r1?(init_loadingImages(),init_info()):uponFailure()}function init_screens(){var wx=window.innerWidth,wy=window.innerHeight;library.scr[0]=wx,library.scr[1]=wy,library.canvas[0]=wx,library.canvas[1]=wy;var m;m=400>wx?.75:wx>=400&&1e3>wx?1.25:wx>=1e3&&1600>wx?1.5:wx>=1600?2:1,library.multiplier=m,elements.message.style.top=.45*library.scr[1]+"px",elements.c=elements.canvas.getContext("2d");var result;return null!==elements.c?(elements.canvas.setAttribute("height",library.canvas[1]),elements.canvas.setAttribute("width",library.canvas[0]),result=!0):(library.data.poop=!0,result=!1),result}function init_loadingImages(){var assets=[library.pim,library.magic,library.portal,library.poof,library.skull,library.bg,library.excla],music=[library.ghost_sound,library.zombie_sound,library.transform_sound,library.portal_sound,library.player_sound];library.pim.src="images/pimsheet.svg",library.magic.src="images/magic.svg",library.portal.src="images/portal.svg",library.poof.src="images/poof.svg",library.skull.src="images/skull.svg",library.bg.src="images/background_3.svg",library.excla.src="images/exclamation.svg",library.ghost_sound.src="track/Ghost_01.wav",library.zombie_sound.src="track/Action-02.wav",library.transform_sound.src="track/Powerup_01.wav",library.portal_sound.src="track/Portal-01.wav",library.player_sound.src="track/Function-Change-01.wav";for(var i=0;i<assets.length;i++)assets[i].addEventListener("load",finishedLoading,!1);var test=document.createElement("audio");if(test.setAttribute("oncanplay","return"),null===test.oncanplay)for(var j=0;j<music.length;j++)music[j].addEventListener("canplay",finishedLoading,!1);else finishedLoading(),finishedLoading(),finishedLoading(),finishedLoading(),finishedLoading()}function init_info(){checkLocalStorage();var playerRandom=Math.floor(3*Math.random());game.player=library.data.player[playerRandom],elements.player_action.textContent=game.player,prepareScreen(),elements.music.addEventListener("click",toggleSound,!1),elements.music.addEventListener("touchstart",toggleSound,!1)}function prepareScreen(){elements.play.addEventListener("click",goToGame,!1),elements.play.addEventListener("touchstart",goToGame,!1),elements.open_tutorial.addEventListener("click",accessTutorial,!1),elements.open_tutorial.addEventListener("touchstart",accessTutorial,!1)}function goToGame(event){elements.opening.style.opacity=0,elements.opening.addEventListener("transitionend",goToGameScreen,!1),event.preventDefault()}function goToGameScreen(){elements.opening.removeEventListener("transitionend",goToGameScreen,!1),elements.opening.classList.add("hidden"),elements.game.classList.remove("hidden"),window.setTimeout(function(){elements.game.style.opacity=1,elements.game.addEventListener("transitionend",prepGame,!1)},100)}function prepGame(){elements.game.removeEventListener("transitionend",prepGame,!1),message("get ready",2500),window.setTimeout(function(){message("go!",750),game_start()},3e3)}function game_start(){elements.c.clearRect(0,0,library.canvas[0],library.canvas[1]),elements.c.globalAlpha=1,reset_game_info("game"),game.start=new Date,game.running=!0,initCreate(),game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100),elements.help_button.addEventListener("click",showHelp,!1),elements.help_button.addEventListener("touchstart",showHelp,!1),elements.canvas.addEventListener("click",pushPim,!1),elements.canvas.addEventListener("touchstart",pushPim,!1)}function reset_game_info(forwhat){game.start=0,game.end=0,game.total=0,game.score=0,game.running=!1,game.finished=!1,"tutorial"===forwhat?(game.pims.length=0,game.skulls.length=0,game.magic.length=0,game.limit[0]=1,game.limit[1]=0,game.limit[2]=0):(game.round=library.data.rounds,game.pims.length=0,game.skulls.length=0,game.magic.length=0,game.limit[0]=game.round+3,game.limit[1]=game.round+3,game.limit[2]=Math.floor(5*Math.random())+2*game.round+10),window.clearInterval(game.loop),window.clearInterval(game.player_loop),game.player=library.data.player[Math.floor(3*Math.random())]}function roundOver(){game.running=!1,game.finished=!0,window.clearInterval(game.player_loop),elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1),game.end=new Date;var total=(game.end.getTime()-game.start.getTime())/1e3/60;game.total+=total,library.data.rounds++;var score=library.data.rounds*(game.limit[0]/3+3)*1e3-60*total*2;score=Math.round(score),game.score=score,checkHighscore(score),showEnd()}function checkHighscore(num){num&&num>library.data.highscore&&(library.data.highscore=num,window.localStorage.pimbo=num)}function checkLocalStorage(){if(window.localStorage.pimbo){var hs=Number(window.localStorage.pimbo);library.data.highscore=hs,elements.highscore_open.textContent=hs,elements.highscore_open.parentElement.classList.remove("hidden")}else window.localStorage.setItem("pimbo",0)}function showHelp(event){game.running=!1,window.clearInterval(game.loop),window.clearInterval(game.player_loop),elements.help_button.textContent=">",game.end=new Date;var total=(game.end.getTime()-game.start.getTime())/1e3/60;game.total+=total,updateHelpInfo(),elements.info.classList.remove("hidden"),window.setTimeout(function(){elements.info.style.opacity=1},100),elements.help_button.classList.remove("helphover"),elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1),elements.help_button.removeEventListener("click",showHelp,!1),elements.help_button.removeEventListener("touchstart",showHelp,!1),elements.info_close.addEventListener("click",hideHelp,!1),elements.info_close.addEventListener("touchstart",hideHelp,!1),event.preventDefault()}function updateHelpInfo(){var hs,prettyTime=Math.floor(game.total)+":";prettyTime+=60*(1-(Math.ceil(game.total)-game.total)),elements.info_round.textContent=library.data.rounds+1,elements.info_time.textContent=Math.round(60*game.total)+" seconds",hs=library.data.highscore?library.data.highscore:"noop",elements.highscore_info.textContent=hs}function hideHelp(event){elements.info.style.opacity=0,elements.help_button.textContent="||",elements.help_button.classList.add("helphover"),elements.info_close.removeEventListener("click",hideHelp,!1),elements.info_close.removeEventListener("touchstart",hideHelp,!1),elements.info.addEventListener("transitionend",startGameAgain,!1),event.preventDefault()}function startGameAgain(){elements.info.removeEventListener("transitionend",startGameAgain,!1),elements.info.classList.add("hidden"),window.setTimeout(function(){game.running=!0,game.start=new Date,game.player_loop=window.setInterval(player_change_action,5e3),game.loop=window.setInterval(gameUpdate,100),elements.help_button.addEventListener("click",showHelp,!1),elements.help_button.addEventListener("touchstart",showHelp,!1),elements.canvas.addEventListener("click",pushPim,!1),elements.canvas.addEventListener("touchstart",pushPim,!1)},200)}function showEnd(){elements.end_message.textContent=endGameMessage(),elements.end_ghosts.textContent=game.limit[0]+" pims",elements.end_time.textContent=Math.round(60*game.total)+" seconds",elements.end_score.textContent=game.score,elements.highscore_end.textContent=library.data.highscore,elements.highscore_end.parentElement.classList.remove("hidden"),elements.help_button.classList.remove("helphover"),elements.ending.classList.remove("hidden"),window.setTimeout(function(){elements.ending.style.opacity=1},500),elements.canvas.removeEventListener("click",pushPim,!1),elements.canvas.removeEventListener("touchstart",pushPim,!1),elements.help_button.removeEventListener("click",showHelp,!1),elements.help_button.removeEventListener("touchstart",showHelp,!1),elements.play_again.addEventListener("click",playAgain,!1),elements.play_again.addEventListener("touchstart",playAgain,!1)}function playAgain(event){elements.ending.style.opacity=0,elements.ending.addEventListener("transitionend",showGameScreenAgain,!1),event.preventDefault()}function showGameScreenAgain(){this.removeEventListener("transitionend",showGameScreenAgain,!1),elements.ending.classList.add("hidden"),elements.play_again.removeEventListener("click",playAgain,!1),elements.play_again.removeEventListener("touchstart",playAgain,!1),message("get ready",2e3),window.setTimeout(function(){game_start(),message("go!",500),elements.canvas.addEventListener("touchstart",pushPim,!1),elements.canvas.addEventListener("click",pushPim,!1),elements.help_button.addEventListener("click",showHelp,!1),elements.help_button.addEventListener("touchstart",showHelp,!1),elements.help_button.classList.add("helphover")},2e3)}function message(str,t){elements.message.textContent=str,elements.message.classList.remove("hidden"),window.setTimeout(function(){elements.message.classList.add("hidden")},t)}function toggleSound(event){library.data.music?(library.data.music=!1,elements.music.textContent="sound is off"):(library.data.music=!0,elements.music.textContent="sound is on"),event.preventDefault()}function uponFailure(){var fail=document.createElement("p");fail.innerHTML="Sorry, this browser does not support <strong>canvas</strong>. You need canvas to play this game. Please consider another browser for your gaming pleasure.",elements.loading.appendChild(fail)}function finishedLoading(){this.volume=.45,this.removeEventListener("load",finishedLoading,!1),library.assetsLoaded++,library.assetsLoaded===library.totalAssets&&allAssetsLoaded()}function allAssetsLoaded(){elements.ball.classList.remove("bouncy"),window.setTimeout(function(){elements.loading.style.opacity=0,elements.loading.addEventListener("transitionend",showHomeScreen,!1)},500)}function showHomeScreen(){elements.loading.removeEventListener("transitionend",showHomeScreen,!1),elements.loading.classList.add("hidden"),elements.opening.classList.remove("hidden"),window.setTimeout(function(){elements.opening.style.opacity=1},100)}function endGameMessage(){var message,which,rank,t=60*game.total;return t>120?rank=2:t>30&&120>=t?rank=1:30>=t&&(rank=0),which=Math.floor(Math.random()*endMessages[rank].length),message=endMessages[rank][which],console.log("end message: "+message),message}global.pimbo=exports;var library={pim:new Image,magic:new Image,portal:new Image,poof:new Image,skull:new Image,bg:new Image,excla:new Image,ghost_sound:new Audio,zombie_sound:new Audio,transform_sound:new Audio,portal_sound:new Audio,player_sound:new Audio,totalAssets:12,assetsLoaded:0,scr:[],canvas:[],multiplier:0,pim_size:[864,1248,72,96],magic_size:[256,192,64,64],portal_size:[288,64,72,64],poof_size:[288,96,72,96],skull_size:[64,64],excla_size:[14,32],bg_size:[100,500],data:{poop:!1,highscore:null,rounds:0,music:!0,player:["reverse","clockwise","counter-clockwise"],color:["cyan","magenta","yellow"]}},game={start:null,end:null,total:0,score:0,running:!1,finished:!0,round:0,pims:[],skulls:[],magic:[],portal:[],limit:[null,null,null,1],player:null,player_loop:null,loop:null},elements={loading:document.getElementById("loading-screen"),opening:document.getElementById("open-screen"),game:document.getElementById("game-screen"),ending:document.getElementById("end-screen"),info:document.getElementById("info-screen"),player_action:document.getElementById("game-action"),canvas:document.getElementById("game-canvas"),c:null,ball:document.querySelector(".ball"),info_round:document.getElementById("info-round"),info_time:document.getElementById("info-time"),end_message:document.querySelector(".rando"),end_ghosts:document.getElementById("end-ghost-count"),end_time:document.getElementById("end-time"),end_score:document.getElementById("end-score"),open_tutorial:document.getElementById("open-tutorial"),tutorial:document.getElementById("tutorial"),tut_h:document.getElementById("tutorial").querySelector("h2"),tut_p:document.getElementById("tutorial").querySelectorAll("p")[0],tut_b:document.getElementById("tutorial").querySelectorAll("p")[1],play:document.getElementById("open-play"),play_again:document.getElementById("end-play"),help_button:document.getElementById("game-help"),info_close:document.getElementById("info-closer"),message:document.getElementById("mega-message"),music:document.getElementById("sound-toggle"),highscore_open:document.getElementById("open-hs"),highscore_info:document.getElementById("info-highscore"),highscore_end:document.getElementById("end-hs")},endMessages=[["You've saved a generation of pims.","All the pims were saved, and slept soundly that night.","The rescue pims-from-pimbo plan was completed so quickly, you'll be mailed a medal in 2 weeks.","We all outta pims.","The pims are thankful.","Making it through the light, the pims lived to see another pimbo."],["You might be seeing more pims in pimbo, son.","Better check that all the zombies are gone.","The pims won't get you... today.","So proud. So pim. So wow.","I might be emotional right now."],["I might be emotional, but not for any of the right reasons.","You all outta skill","Go home, player. You must be drunk.","The pims are coming to get you for making them suffer in pimbo for so long.","Pimter is coming.","Get ready to live in pimbo, you got a first class ticket there.","Could you take any longer? Gaw!","You turned into a zombie for taking so long to save the pims."]];Pim.prototype.changeDirection=function(cause){var current=this.direction,options=["up","down","left","right"];if("random"===cause){for(var ind=options.indexOf(current),opt=[],i=0;4>i;i++)i!==ind&&opt.push(options[i]);var rando=Math.floor(3*Math.random());this.direction=opt[rando],this.countdown=Math.floor(5*Math.random())+5}else if("player"===cause){var p=game.player;"reverse"===p?"up"===current?this.direction="down":"down"===current?this.direction="up":"left"===current?this.direction="right":"right"===current&&(this.direction="left"):"clockwise"===p?"up"===current?this.direction="right":"down"===current?this.direction="left":"left"===current?this.direction="up":"right"===current&&(this.direction="down"):"counter-clockwise"===p&&("up"===current?this.direction="left":"down"===current?this.direction="right":"left"===current?this.direction="down":"right"===current&&(this.direction="up")),this.primed=!0,"ghost"===this.state?playMusic(library.ghost_sound):"zombie"===this.state&&playMusic(library.zombie_sound),this.prime_countdown=10}},Pim.prototype.collide=function(){var pd=[];pd[0]=this.pos[0],pd[1]=this.pos[1],"ghost"===this.state?this.checkCollide("skulls",.65,pd):"zombie"===this.state&&this.checkCollide("magic",.55,pd)},Pim.prototype.checkCollide=function(obj,sensitivity,pd){for(var item,check=game[obj],threshold=[sensitivity*library.pim_size[2],sensitivity*library.pim_size[3]],id=[],collect=!1,i=0;i<check.length;i++)item=check[i],id[0]=item.pos[0],id[1]=item.pos[1],Math.abs(id[0]-pd[0])<=threshold[0]&&Math.abs(id[1]-pd[1])<=threshold[1]&&("zombie"===this.state&&this.color===item.color?collect=!0:"ghost"===this.state&&(collect=!0)),collect&&("ghost"===this.state?this.state="zombie":"zombie"===this.state&&(this.state="pim",this.dancing=!0),playMusic(library.transform_sound),this.countdown=Math.floor(6*Math.random())+1,this.primed=!1,this.prime_countdown=10,this.tick=0,this.poof=!0,check.splice(i,1),collect=!1)},Pim.prototype.goToLight=function(){this.onDestiny=!0,this.destiny[0]=game.portal[0].pos[0],this.destiny[1]=0,this.direction=this.pos[0]<this.destiny[0]?"right":"left"};var tutorial={step:0,checking:null,instructions:[["Here is a ghost.","This ghost was once a pim. Now it floats around aimlessly, stuck in pimbo.","next"],["You can help this ghost.","The ghost will continue to wander aimlessly, until you <strong>prime</strong> it. <strong>Click on the ghost to prime it.<strong>","game.pims[0].primed"],['See the <strong>"!"</strong>',"Now the ghost is primed: it's on the lookout for <strong>skulls</strong> now. Collecting <strong>skulls</strong> will turn the ghost into a zombie.","next"],["Priming doesn't last","The ghost will lose interest if left on it's own for too long. Clicking it again will <strong>prime</strong> it again.","next"],["Direct the ghost","See the container at the bottom? It contains the keyword that determines what happens when you click the ghost. It changes every 5 seconds. Use this to direct the ghost to the <strong>skull</strong>.","game.pims[0].state === 'zombie'"],["Look! A zombie!","Now that the ghost collected a <strong>skull</strong>, it's turned into a zombie. It's on its way to becoming a full fledged pim again.","next"],["Zombies need life.","Just like ghosts needed <strong>skulls</strong>, zombies will need <strong>life</strong> to become pims.","next"],["The same rules apply.","Direct the zombies by <strong>clicking</strong> them towards life. The color of the life must match the color of the pim, and it needs to be <strong>primed</strong> in order to know what to look for.","game.pims[0].state === 'pim'"],["Good job!","You helped the pim reach its true form. It's celebrating right now.","next"],["Clear the board.","To win the round, you will need to clear the board by helping all the pims reach their true form. The faster you are, the more points you'll get at the end of the round.","next"],["Going to the light","Pims finished will go to the light. Quite fitting.","again"]],next:function(){this.step++},again:function(){this.step=0},amount:function(){return this.instructions.length}};init()}({},function(){return this}());